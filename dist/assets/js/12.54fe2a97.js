(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{367:function(t,e,s){"use strict";s.r(e);var n=s(45),a=Object(n.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("p",[t._v("使用umi-request作为请求库。\numi-request 与 fetch, axios 异同")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("特性")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("umi-request")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("fetch")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("axios")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("实现")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("浏览器原生支持")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("浏览器原生支持")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("XMLHttpRequest")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("大小")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("9k")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("4k (polyfill)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("14k")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("query 简化")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("post 简化")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("超时")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("缓存")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("错误检查")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("错误处理")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("拦截器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("前缀")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("后缀")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("处理 gbk")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("中间件")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("取消请求")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("❌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("✅")])])])]),t._v(" "),s("h2",{attrs:{id:"get"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#get"}},[t._v("#")]),t._v(" Get")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("import request from 'umi-request';\n\nrequest\n  .get('/api/v1/xxx?id=1')\n  .then(function(response) {\n    console.log(response);\n  })\n  .catch(function(error) {\n    console.log(error);\n  });\n\n// use options.params\nrequest\n  .get('/api/v1/xxx', {\n    params: {\n      id: 1,\n    },\n  })\n  .then(function(response) {\n    console.log(response);\n  })\n  .catch(function(error) {\n    console.log(error);\n  });\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br")])]),s("h2",{attrs:{id:"post"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#post"}},[t._v("#")]),t._v(" Post")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("request\n  .post('/api/v1/user', {\n    data: {\n      name: 'Mike',\n    },\n  })\n  .then(function(response) {\n    console.log(response);\n  })\n  .catch(function(error) {\n    console.log(error);\n  });\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("h2",{attrs:{id:"errorhandle"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#errorhandle"}},[t._v("#")]),t._v(" ErrorHandle")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("// 对umi-request的扩展\nimport { extend } from 'umi-request';\nimport { notification } from 'antd';\n\nconst TIME_DELAY = 3000; // 超时时间\nconst codeMessage = {\n  200: '服务器成功返回请求的数据。',\n  201: '新建或修改数据成功。',\n  202: '一个请求已经进入后台排队（异步任务）。',\n  204: '删除数据成功。',\n  400: '发出的请求有错误，服务器没有进行新建或修改数据的操作。',\n  401: '用户没有权限（令牌、用户名、密码错误）。',\n  403: '用户得到授权，但是访问是被禁止的。',\n  404: '发出的请求针对的是不存在的记录，服务器没有进行操作。',\n  406: '请求的格式不可得。',\n  410: '请求的资源被永久删除，且不会再得到的。',\n  422: '当创建一个对象时，发生一个验证错误。',\n  500: '服务器发生错误，请检查服务器。',\n  502: '网关错误。',\n  503: '服务不可用，服务器暂时过载或维护。',\n  504: '网关超时。',\n};\nconst COMMON_ERROR = '系统异常，请稍后再试';\n\n/**\n * 异常处理程序\n */\nconst errorHandler = (error) => {\n  const { response = {} } = error;\n  const errorText = response.errorMsg || codeMessage[response.status] || COMMON_ERROR;\n  const { status, url } = response;\n\n  notification.error({\n    message: `请求错误 ${status}: ${url}`,\n    description: errorText,\n  });\n};\n\nconst extendRequest = extend({ errorHandler, credentials: 'include', timeout: TIME_DELAY });\n\nexport default extendRequest;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br")])])])}),[],!1,null,null,null);e.default=a.exports}}]);